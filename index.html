<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ponto Pro - Sistema de Banco de Horas</title>
    <style>
        :root {
            --primary: #1a73e8;
            --border: #dadce0;
            --bg: #f8f9fa;
            --text: #3c4043;
            --success: #188038;
            --danger: #d93025;
        }

        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        
        .header { text-align: center; margin-bottom: 30px; }
        .controls { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 20px; }
        
        button { 
            background: white; border: 1px solid var(--border); padding: 8px 16px; 
            border-radius: 4px; cursor: pointer; font-weight: 500; transition: all 0.2s;
        }
        button:hover { background: var(--bg); border-color: #bdc1c6; }

        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(60,64,67,0.3); }
        th { background: #f1f3f4; padding: 12px; font-size: 12px; font-weight: 500; text-transform: uppercase; color: #5f6368; border-bottom: 1px solid var(--border); }
        td { padding: 8px; text-align: center; border-bottom: 1px solid #f1f3f4; }

        /* Estilização do Campo HH:MM Profissional */
        .time-field {
            display: inline-flex;
            align-items: center;
            background: white;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 4px 8px;
            width: 80px;
            transition: border-color 0.2s, box-shadow 0.2s;
            cursor: text;
        }

        .time-field:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 1px var(--primary);
        }

        .time-unit {
            border: none;
            width: 22px;
            text-align: center;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            color: var(--text);
            padding: 0;
            background: transparent;
        }

        .time-separator {
            font-weight: bold;
            color: #70757a;
            user-select: none;
            padding: 0 1px;
        }

        /* Indicadores de Resultado */
        .total-cell { font-weight: bold; color: #5f6368; }
        .extra-cell { font-weight: bold; }
        .positivo { color: var(--success); }
        .negativo { color: var(--danger); }

        .summary { margin-top: 20px; text-align: right; font-size: 18px; font-weight: 500; padding: 15px; background: white; border-radius: 8px; }
    </style>
</head>
<body>

<div class="header">
    <h2>Marcação de Ponto</h2>
</div>

<div class="controls">
    <button onclick="changeMonth(-1)">◀ Anterior</button>
    <span id="currentMonth" style="font-size: 1.1rem; font-weight: 500; min-width: 150px; text-align: center;"></span>
    <button onclick="changeMonth(1)">Próximo ▶</button>
</div>

<table id="pontoTable">
    <thead>
        <tr>
            <th>Data</th>
            <th>Dia</th>
            <th>Entrada</th>
            <th>Saída Alm.</th>
            <th>Entrada Alm.</th>
            <th>Saída</th>
            <th>Total</th>
            <th>Extra (08:48)</th>
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<div class="summary" id="monthlySummary">Saldo do Mês: 00:00</div>

<script>
    const JORNADA_MINUTOS = 528; // 08:48
    let currentDate = new Date(2026, 0, 1);

    function changeMonth(step) {
        currentDate.setMonth(currentDate.getMonth() + step);
        renderTable();
    }

    function renderTable() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const monthName = new Intl.DateTimeFormat('pt-BR', { month: 'long', year: 'numeric' }).format(currentDate);
        
        document.getElementById('currentMonth').innerText = monthName.toUpperCase();
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';

        for (let d = 1; d <= daysInMonth; d++) {
            const date = new Date(year, month, d);
            const dayName = new Intl.DateTimeFormat('pt-BR', { weekday: 'short' }).format(date);
            const key = `ponto-${year}-${month}-${d}`;
            const saved = JSON.parse(localStorage.getItem(key)) || ["", "", "", ""];

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${String(d).padStart(2, '0')}/${String(month + 1).padStart(2, '0')}</td>
                <td><small>${dayName.replace('.', '')}</small></td>
                ${saved.map((val, i) => `<td>${createTimeField(val, d, i)}</td>`).join('')}
                <td class="total-cell" id="total-${d}">00:00</td>
                <td class="extra-cell" id="extra-${d}">00:00</td>
            `;
            tbody.appendChild(tr);
            calculateRow(d);
        }
    }

    function createTimeField(value, day, index) {
        const [hh, mm] = value ? value.split(':') : ["", ""];
        return `
            <div class="time-field" onclick="this.querySelector('.time-unit').focus()">
                <input type="text" class="time-unit hh" maxlength="2" placeholder="00" value="${hh}" 
                    oninput="handleInput(this, ${day}, ${index}, 'hh')" 
                    onkeydown="handleKeyDown(this, ${day}, ${index}, 'hh')">
                <span class="time-separator">:</span>
                <input type="text" class="time-unit mm" maxlength="2" placeholder="00" value="${mm}" 
                    oninput="handleInput(this, ${day}, ${index}, 'mm')" 
                    onkeydown="handleKeyDown(this, ${day}, ${index}, 'mm')">
            </div>
        `;
    }

    function handleInput(el, day, blockIndex, type) {
        let val = el.value.replace(/\D/g, '');
        
        // Validação de limite
        if (type === 'hh' && parseInt(val) > 23) val = '23';
        if (type === 'mm' && parseInt(val) > 59) val = '59';
        
        el.value = val;

        // Avanço automático
        if (val.length === 2) {
            if (type === 'hh') {
                el.nextElementSibling.nextElementSibling.focus();
            } else {
                saveData(day);
                focusNextBlock(day, blockIndex);
            }
        }
    }

    function handleKeyDown(el, day, blockIndex, type) {
        if (el.value === '' && event.key === 'Backspace' && type === 'mm') {
            el.previousElementSibling.previousElementSibling.focus();
        }
    }

    function focusNextBlock(day, blockIndex) {
        if (blockIndex < 3) {
            const nextField = document.querySelectorAll(`#tableBody tr`)[day-1].querySelectorAll('.time-field')[blockIndex + 1];
            nextField.querySelector('.hh').focus();
        }
    }

    function saveData(day) {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const row = document.querySelectorAll(`#tableBody tr`)[day-1];
        const fields = row.querySelectorAll('.time-field');
        const data = Array.from(fields).map(f => {
            const h = f.querySelector('.hh').value;
            const m = f.querySelector('.mm').value;
            return (h && m) ? `${h.padStart(2,'0')}:${m.padStart(2,'0')}` : "";
        });

        localStorage.setItem(`ponto-${year}-${month}-${day}`, JSON.stringify(data));
        calculateRow(day);
    }

    function calculateRow(day) {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const data = JSON.parse(localStorage.getItem(`ponto-${year}-${month}-${day}`)) || ["", "", "", ""];
        
        const toMin = (str) => {
            if (!str) return null;
            const [h, m] = str.split(':').map(Number);
            return (h * 60) + m;
        };

        const e1 = toMin(data[0]), s1 = toMin(data[1]), e2 = toMin(data[2]), s2 = toMin(data[3]);

        if (e1 !== null && s1 !== null && e2 !== null && s2 !== null) {
            const trabalhadas = (s2 - e1) - (e2 - s1);
            const extras = trabalhadas - JORNADA_MINUTOS;

            document.getElementById(`total-${day}`).innerText = formatMin(trabalhadas);
            const extraEl = document.getElementById(`extra-${day}`);
            extraEl.innerText = formatMin(extras);
            extraEl.className = `extra-cell ${extras >= 0 ? 'positivo' : 'negativo'}`;
        }
        updateGlobalSummary();
    }

    function formatMin(m) {
        const sign = m < 0 ? "-" : "";
        const abs = Math.abs(m);
        const hh = String(Math.floor(abs / 60)).padStart(2, '0');
        const mm = String(abs % 60).padStart(2, '0');
        return `${sign}${hh}:${mm}`;
    }

    function updateGlobalSummary() {
        let totalExtra = 0;
        document.querySelectorAll('.extra-cell').forEach(el => {
            const val = el.innerText;
            if (val === "00:00") return;
            const isNeg = val.startsWith('-');
            const [h, m] = val.replace('-', '').split(':').map(Number);
            totalExtra += isNeg ? -((h * 60) + m) : ((h * 60) + m);
        });
        const summaryEl = document.getElementById('monthlySummary');
        summaryEl.innerText = `Saldo do Mês: ${formatMin(totalExtra)}`;
        summaryEl.className = `summary ${totalExtra >= 0 ? 'positivo' : 'negativo'}`;
    }

    renderTable();
</script>

</body>
</html>